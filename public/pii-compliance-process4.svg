<svg viewBox="0 0 1000 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Drop shadow filter -->
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
      <feOffset dx="2" dy="2" result="offsetblur"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.3"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333"/>
    </marker>
    
    <!-- Check mark icon -->
    <symbol id="checkmark" viewBox="0 0 24 24">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="#22c55e"/>
    </symbol>
    
    <!-- X mark icon -->
    <symbol id="xmark" viewBox="0 0 24 24">
      <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="#ef4444"/>
    </symbol>
  </defs>
  
  <!-- Title -->
  <text x="500" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#1f2937">
    PII Compliance Testing Architecture
  </text>
  
  <!-- Source Files Section -->
  <g id="source-files">
    <!-- Container box for source files -->
    <rect x="50" y="50" width="900" height="160" rx="10" fill="none" stroke="#475569" stroke-width="2"/>
    <text x="500" y="75" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1f2937">
      Source Code
    </text>
    
    <!-- schema.sql -->
    <rect x="80" y="90" width="180" height="100" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
    <text x="170" y="110" font-family="monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#1e40af">
      schema.sql
    </text>
    <text x="170" y="130" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#475569">
      Database Schema
    </text>
    <g font-family="monospace" font-size="10" fill="#334155">
      <text x="90" y="150">• user_id</text>
      <text x="90" y="165">• email</text>
      <text x="90" y="180">• created_at</text>
    </g>
    
    <!-- pii.yml -->
    <rect x="410" y="90" width="180" height="100" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" filter="url(#shadow)"/>
    <text x="500" y="110" font-family="monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#92400e">
      pii.yml
    </text>
    <text x="500" y="130" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#475569">
      PII Classification
    </text>
    <g font-family="monospace" font-size="10" fill="#334155">
      <text x="420" y="150">user_id: false</text>
      <text x="420" y="165">email: true</text>
      <text x="420" y="180">created_at: false</text>
    </g>
    
    <!-- delete.rb -->
    <rect x="740" y="90" width="180" height="100" rx="8" fill="#fce7f3" stroke="#ec4899" stroke-width="2" filter="url(#shadow)"/>
    <text x="830" y="110" font-family="monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#9f1239">
      delete.rb
    </text>
    <text x="830" y="130" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#475569">
      Deletion Script
    </text>
    <g font-family="monospace" font-size="10" fill="#334155">
      <text x="750" y="150">user.find(...)</text>
      <text x="750" y="165">  .delete()</text>
      <text x="750" y="180">return [:email, ...]</text>
    </g>

  </g>
  
  <!-- Arrow to test suite -->
  <path d="M 500 210 L 500 240" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Test Suite Container -->
  <rect x="50" y="250" width="900" height="420" rx="10" fill="#f8fafc" stroke="#64748b" stroke-width="2" stroke-dasharray="5,5">
    <animate attributeName="stroke-dashoffset" from="0" to="10" dur="0.5s" repeatCount="indefinite"/>
  </rect>
  <text x="500" y="280" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#1f2937">
    Automated Unit Test Suite
  </text>
  
  <!-- Test 1: Schema Sync -->
  <g id="test1" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="0.5s" fill="freeze"/>
    
    <rect x="80" y="310" width="260" height="140" rx="8" fill="#fff" stroke="#8b5cf6" stroke-width="2" filter="url(#shadow)"/>
    <rect x="80" y="310" width="260" height="35" rx="8" fill="#8b5cf6"/>
    <text x="210" y="333" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
      Test 1: Schema Sync
    </text>
    
    <text x="210" y="365" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#475569">
      Metaprogramming Test
    </text>
    
    <g font-family="Arial, sans-serif" font-size="11" fill="#334155">
      <text x="90" y="390">✓ Compare field lists</text>
      <text x="90" y="410">✓ schema.sql ⟷ pii.yml</text>
      <text x="90" y="430">✗ Fail if fields missing</text>
    </g>
  </g>
  
  <!-- Test 2: Deletion Coverage -->
  <g id="test2" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="1.3s" fill="freeze"/>
    
    <rect x="370" y="310" width="260" height="140" rx="8" fill="#fff" stroke="#ec4899" stroke-width="2" filter="url(#shadow)"/>
    <rect x="370" y="310" width="260" height="35" rx="8" fill="#ec4899"/>
    <text x="500" y="333" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
      Test 2: Deletion Coverage
    </text>
    
    <text x="500" y="365" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#475569">
      Script Verification
    </text>
    
    <g font-family="Arial, sans-serif" font-size="11" fill="#334155">
      <text x="380" y="390">✓ PII field marked?</text>
      <text x="380" y="410">✓ Delete script handles it?</text>
      <text x="380" y="430">✓ Returns proof of deletion</text>
    </g>
  </g>
  
  <!-- Test 3: Database Validation -->
  <g id="test3" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="2.1s" fill="freeze"/>
    
    <rect x="660" y="310" width="260" height="140" rx="8" fill="#fff" stroke="#06b6d4" stroke-width="2" filter="url(#shadow)"/>
    <rect x="660" y="310" width="260" height="35" rx="8" fill="#06b6d4"/>
    <text x="790" y="333" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">
      Test 3: DB Validation
    </text>
    
    <text x="790" y="365" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#475569">
      Database-Level Test
    </text>
    
    <g font-family="Arial, sans-serif" font-size="11" fill="#334155">
      <text x="670" y="390">✓ Actually deleted from DB?</text>
      <text x="670" y="410">✗ Not just mocked response</text>
      <text x="670" y="430">✓ Verify data removed</text>
    </g>
  </g>
  
  <!-- Test Flow Arrows -->
  <path d="M 340 380 L 370 380" stroke="#8b5cf6" stroke-width="2" fill="none" marker-end="url(#arrowhead)" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.4s" begin="1.1s" fill="freeze"/>
  </path>
  <path d="M 630 380 L 660 380" stroke="#ec4899" stroke-width="2" fill="none" marker-end="url(#arrowhead)" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.4s" begin="1.9s" fill="freeze"/>
  </path>
  <path d="M 790 450 L 790 480" stroke="#06b6d4" stroke-width="2" fill="none" marker-end="url(#arrowhead)" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.4s" begin="2.7s" fill="freeze"/>
  </path>
  
  <!-- Results Section -->
  <g id="results" opacity="0">
    <animate attributeName="opacity" from="0" to="1" dur="0.6s" begin="2.9s" fill="freeze"/>
    
    <rect x="80" y="490" width="840" height="160" rx="8" fill="#fff" stroke="#22c55e" stroke-width="3" filter="url(#shadow)"/>
    <rect x="80" y="490" width="840" height="40" rx="8" fill="#22c55e"/>
    <text x="500" y="516" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="white">
      Compliance Guarantee
    </text>
    
    <g font-family="Arial, sans-serif" font-size="13" fill="#1f2937">
      <text x="500" y="555" text-anchor="middle" font-weight="bold">All tests must pass for deployment ✓</text>
      <text x="120" y="585">• Schema and PII config stay synchronized</text>
      <text x="120" y="610">• Every PII field has proven deletion mechanism</text>
      <text x="120" y="635">• Database integrity verified at test time</text>
    </g>
  </g>

</svg>